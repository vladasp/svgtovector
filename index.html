<style>
    p{
        color: #ccc;
        margin: 20px, 20px;
    }
    #byte_content {
        margin: 5px 0;
        max-height: 400px;
        overflow-y: auto;
        overflow-x: hidden;
        color: #e4e4e4;
    }
    #list{
        color: #ccc;
    }
    #body{
        background: #505050;
    }
    #parse{
        display: none;
    }
    input[type="file"] {
        display: none;
    }
    .custom-file-upload {
        border: 1px solid #ccc;
        border-radius: 7px;
        display: inline-block;
        padding: 6px 12px;
        cursor: pointer;
        color: #eeeeee;
    }
</style>
  <header>
        <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  </header>
  <body id="body">
    <p>Select and parse SVG files</p>
    <label for="files" class="custom-file-upload">
        <i class="fa fa-cloud-upload"></i> Load files
    </label>
    <input type="file" id="files" accept=".svg" multiple="true" onloadeddata="loaded()"/>
    <label for="parse" class="custom-file-upload">
        <i class="fa fa-cloud-upload"></i> Parse and save
    </label>
    <button id="parse" onclick="readBlob()">read file</button>
    <output id="list"></output>
    <div id="byte_content"></div>
    <BR/>
  </body>
  
<script>
'use strict';

    class Root {
        constructor(width, height, viewPortWidth, viewPortHeight) {
        this.width = width;
        this.height = height;
        this.viewPortWidth = viewPortWidth;
        this.viewPortHeight = viewPortHeight;
        }
    }

    class Path {
        constructor(d, fill, id){
            this.d = d;
            this.fill = fill;
            this.id = id;
        }
    }

    var pathList = [];
    var root = new Root();
    var names = [];

    function readBlob() {
        var files = document.getElementById('files').files;
    
        if (!files.length) {
            alert('Please select a file!');
            return;
        }

        for (let j = 0; j < files.length; j++) {
            var name = files[j].name.split('.')[0] + ".xml";
            names.push(name);
        }

        for (var i = 0, file; file = files[i]; i++){

            var reader = new FileReader();

            reader.onloadend = function(evt) {
                if (evt.target.readyState == FileReader.DONE) {
                    var parser = new DOMParser();
                    var xmlDoc = parser.parseFromString(evt.target.result,"text/xml");

                    var svgElement = xmlDoc.getElementsByTagName("svg")[0];

                    var width = svgElement.getAttribute("width");
                    if(width != null)
                        root.width = width;

                    var height = svgElement.getAttribute("height");
                    if(height != null)
                        root.height = height;

                    var viewPort = svgElement.getAttribute("viewBox");
                    if(viewPort != null){
                        var viewPortList = viewPort.split(' ');
                        root.viewPortHeight = viewPortList.pop();
                        root.viewPortWidth = viewPortList.pop();
                    }

                    var paths = xmlDoc.getElementsByTagName("path");
                    for (var index = 0, path; path = paths[index]; index++) {
                        var d = path.getAttribute("d");
                        if(d != null){
                            var pathData = new Path();
                            pathData.d = d;

                            var fill = path.getAttribute("fill");
                            if(fill != null && fill[0] == '#')
                                pathData.fill = fill;

                            var id = path.getAttribute("id");
                            if(id != null)
                                pathData.id = id;

                            pathList.push(pathData);
                        };
                    }

                    var additionals = xmlDoc.getElementsByTagName("g");
                    for (var index = 0, g; g = additionals[index]; index++) {
                        var fill = g.getAttribute("fill");
                        if(fill != null && fill[0] == '#'){
                            var id = g.getAttribute("id");
                            if(id != null){
                                pathList.forEach(path => {
                                    if(id.includes(path.id))
                                        path.fill = fill; 
                                });
                            }
                        }
                    }

                    var xmlString = "<?xml version='1.0' encoding='utf-8'?> <vector></vector>";
                    var parser = new DOMParser();
                    var xmlDoc = parser.parseFromString(xmlString, "text/xml");
                    var vector = xmlDoc.getElementsByTagName("vector");
                    vector[0].setAttribute("xmlns:android", "http://schemas.android.com/apk/res/android");
                    vector[0].setAttribute("android:height", root.height);
                    vector[0].setAttribute("android:width", root.width);
                    vector[0].setAttribute("android:viewportWidth", root.viewPortWidth);
                    vector[0].setAttribute("android:viewportHeight", root.viewPortHeight);

                    pathList.forEach(path => {
                        var node = xmlDoc.createElement("path");
                        if(path.fill != null){
                            node.setAttribute("android:fillColor", path.fill);
                        }
                        node.setAttribute("android:pathData", path.d);
                        vector[0].appendChild(node);
                    });

                    var s = new XMLSerializer();
                    var xmlString = s.serializeToString( xmlDoc );
                    var xmlList = xmlString.split('>');
                    var parsedXml = "";

                    for (let index = 0; index < xmlList.length - 1; index++) {
                        parsedXml += xmlList[index] + '>\n';
                    }

                    var fileBlob = new Blob([parsedXml], {type: "text/xml"});
                    var anchor = document.createElement("a");
                    anchor.download = names.shift();
                    anchor.href = (window.webkitURL || window.URL).createObjectURL(fileBlob);
                    anchor.dataset.downloadurl = ['text/xml', anchor.download, anchor.href].join(':');
                    anchor.click();
                    document.getElementById('byte_content').textContent += pathList[i].d + " | " + pathList[i].fill + " | " + pathList[i].id + "\n";
                }
            }
            reader.readAsBinaryString(file);
        }
    }

    function handleFileSelect(evt) {
        var files = evt.target.files;

        var output = [];
        for (var i = 0, f; f = files[i]; i++) {
            output.push('<li><strong>', escape(f.name), '</strong> (', f.type || 'n/a', ')', '</li>');
        }

        document.getElementById('list').innerHTML = '<ul>' + output.join('') + '</ul>';
    }

    document.getElementById('files').addEventListener('change', handleFileSelect, false);
</script>
